%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Beamer Presentation
% LaTeX Template
% Version 1.0 (10/11/12)
%
% This template has been downloaded from:
% http://www.LaTeXTemplates.com
%
% License:
% CC BY-NC-SA 3.0 (http://creativecommons.org/licenses/by-nc-sa/3.0/)
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%----------------------------------------------------------------------------------------
%   PACKAGES AND THEMES
%----------------------------------------------------------------------------------------

\documentclass{beamer}

\mode<presentation> {

\usetheme{Madrid}
\usecolortheme{whale}
}
\usepackage[utf8]{inputenc}
\usepackage{listings}
\usepackage{graphicx}
\usepackage{booktabs}
\usepackage{color}
\usepackage{textcomp}

%----------------------------------------------------------------------------------------
%   TITLE PAGE
%----------------------------------------------------------------------------------------

\title[Secure Coding]{Secure Coding }

\author{Martin Vesterlund}
\institute[Cybercom]
{
Cybercom Group AB \\
\medskip
\textit{martin.vesterlund@cybercom.com}
}
\date{\today}

\begin{document}
\lstset{
  language=Java,
  showspaces=false,
  showstringspaces=false,
  keywordstyle=\color{blue},
  stringstyle=\color{red},
}
\begin{frame}
  \titlepage % Print the title page as the first slide
\end{frame}

\begin{frame}
  \frametitle{Overview}
  \tableofcontents
\end{frame}

%----------------------------------------------------------------------------------------
%   PRESENTATION SLIDES
%----------------------------------------------------------------------------------------
\section{whoami}
\begin{frame}
  \frametitle{whoami}
  \begin{itemize}
    \item Former BTH student - Master of science in Computer Security
    \item Consultant at Cybercom Karlskrona
    \begin{itemize}
      \item Frontend developer at Försäkringskassan
      \item Frontend developer at Ericsson
      \item Backend developer at Ericsson (focused on integrationtests)
      \item Development Support/QA at Telenor
      \begin{itemize}
        \item CI/CD automation
        \item Test automation
        \item Secure development
        \item System administrator build environment
        \item ...and a lot of other things
      \end{itemize}
    \end{itemize}
    \item Certified Agile Test Driven Developer
  \end{itemize}
\end{frame}
%------------------------------------------------------------------------------
% One slide
%------------------------------------------------------------------------------
\section{Foundation}
\begin{frame}
  \frametitle{Foundation}
  Stuff that helps if they are in use
  \begin{itemize}
    \item Established code standard
    \item Code review process
    \item Static code analysis (Automated)
    \item Tests on various levels (Automated)
  \end{itemize}
\end{frame}
%  \subsection{Code Standard}
%    \begin{frame}
%      \frametitle{Code Standard}
%      \begin{itemize}
%        \item Set of guidelines, or rules, about how the code shall be written
%        \item General formatting rules, such as indentation style, line length and such
%        \item Naming of variables, constants, functions, classes ...
%        \item How to organize the code on various levels
%        \item Can contain specific guidelines of which patterns to follow
%      \end{itemize}
%    \end{frame}

%    \begin{frame}
%      \frametitle{Code Standard - From a security perspective}
%      \begin{itemize}
%        \item Increase the overall readability of the code
%        \item Reduces complexity (if specified in the standard)
%        \item Can be used to enforce use of specific patterns
%        \item Can be used to prohibit use of certain dangerous constructs
%      \end{itemize}
%    \end{frame}

%    \subsection{Code Review}
%    \begin{frame}
%      \frametitle{Code Review}
%      \begin{itemize}
%        \item Manual and Automatic
%        \item A second opionon on the changed code before it goes live
%        \item Make sure the changed code follow the coding standard
%        \item Spread information about what has been done in the code
%        \item Make sure the change is applicable and called for
%        \item Find bugs and problematic/unclear code
%      \end{itemize}
%    \end{frame}

%  \subsection{Static analysis and tests}
%    \begin{frame}
%      \frametitle{Static analysis}
%      \begin{itemize}
%        \item Should be part of automated code review
%        \item Does not test the function of the code (or if can be compiled)
%        \item Used mainly for checking compliance with code standard
%        \item Can be used to highlight some problematic code constructs, such as
%        \begin{itemize}
%          \item Calls to unsafe functions
%          \item SQL-statements with undbound variables
%          \item Possible use of unsafe input
%          \item Might find potential logical bugs
%        \end{itemize}
%      \end{itemize}
%    \end{frame}

%    \begin{frame}
%      \frametitle{Tests}
%      \begin{itemize}
%        \item Should be part of automated code review/build
%        \item Does test the function of the code
%        \item Can be seen as documentation of the code
%        \item Should be mappable against requirements and/or user stories
%        \item There is no difference between normal functional/behavioural tests and security tests!
%      \end{itemize}
%    \end{frame}

  \section{Threat modeling - Crash course}
    \begin{frame}
      \frametitle{Threat modeling - Crash course}
      \begin{itemize}
        \item A systematic way to find and analyse possible threats to the system
        \item Can, and should, be done on several levels (i.e. Overall architecture \textrightarrow module/class)
        \item Several techniques exist
      \end{itemize}
    \end{frame}

    \begin{frame}
      \frametitle{Threat modeling - Basic steps}
      This is just an example of one possible method
      \begin{itemize}
        \item Decompose the application/system into manageable units (from now on \textit{processes})
        preferrably into a diagram
        \item Focus on one process at a time
        \item Identify the dataflows to and from the process and which resources the flows involve (e.g. a database, a web-gui, filesystem, a user)
        \item Add \textit{trust boundaries} to the diagram
      \end{itemize}
    \end{frame}
    \begin{frame}
      \frametitle{Threat modeling - Basic steps, cont.}
      \begin{itemize}
        \item Look at each dataflow, which passes a trust boundary, in turn and determine which threats is present against that flow (this involves attacks against the untrusted resource)
        \begin{itemize}
          \item STRIDE
          \item OWASP top 10
          \item CWE
        \end{itemize}
        \item Rank the found threats, i.e. give it a score
        \begin{itemize}
          \item DREAD
          \item CVSS
          \item Binary Risk Analysis (BRA)
          \item Other system (as long as the threats can be ranked and compared)
        \end{itemize}
        \item List countermeasures and mitigations for each threat
      \end{itemize}
      The ranked list should be used to determine which countermeasures/mitigations
      to prioritise.
    \end{frame}

\section{Secure Code - Crash course}
  \subsection{What defines secure code?} %Remove or move?
    \begin{frame}
      \frametitle{What defines secure code?}
      \begin{itemize}
        \item Overall low complexity
        \item Testable
        \item High readability (e.g. small classes, descriptive names, shallow nesting)
        \item Handles errors gracefully (expects the unexpected)
        \item Does not build upon assumptions about the surroundings (i.e. external interfaces)
        \item Defines and enforce trust boundaries
      \end{itemize}
    \end{frame}

  \subsection{Requirements, User Stories and Tasks}
    \begin{frame}
      \frametitle{Requirements, User Stories and Tasks}
      Based on threat model (and maybe experience)
      \begin{itemize}
        \item Security specific requirements should be added if missing (e.g. \textit{All passwords must be encrypted})
        \item Create evil user stories (e.g. \textit{As a unauthorised attacker I want access to the user database})
        \item Each task should be analysed for potential threats and how to mitigate them
      \end{itemize}
      \begin{block}{It's hard to patch security in}
        When security countermeasures are added as a reaction, there is a risk that the patch itself introduces new vulnerabilities.
        Therefore it is vital to think about potential threats and how to mitigate them as early as possible.
      \end{block}
    \end{frame}

  \subsection{Secure code}
    \begin{frame}
      \frametitle{Secure code - Core}
      \begin{itemize}
        \item Complexity is the enemy of security
        \item Readable code is less likely to hide surprises
        \item Assumptions can lead to bad things
        \item Don't reinvent the wheel
        \item Test early, test often
      \end{itemize}
    \end{frame}
    \begin{frame}
      \frametitle{Secure code - Core, cont.}
      \begin{itemize}
        \item Validate all input
        \item Encode data
        \item Use bound parameters in queries
        \item Handle errors and exceptions
        \item Log wisely
        \item Control access
        \item Protect data
      \end{itemize}
    \end{frame}
    \begin{frame}
      \frametitle{Validate all input (entered of influenced by user)}
      \begin{block}{Rule of thumb}
        Never trust a client or external resource you can't control.
      \end{block}
      \begin{block}{Make sure the input is syntactically valid}
        Syntactical valid input is input that is in an expected format, i.e.
        a name should not contain digits and a postal code should not contain letters.

        This can be done either by whitelisting permitted formats or by blacklisting
        forbidden formats. Whitelisting should be preferred.
      \end{block}
      \begin{block}{Make sure the input is semantically valid}
        Semantical validity means that the input make sense in its' context. In some
        cases this is easy, such as postal codes which can be looked up, and in other
        cases it's really hard.
      \end{block}
    \end{frame}
    \begin{frame}
      \frametitle{Encode data}
      \begin{itemize}
        \item The goal with data encoding is to prevent malicious input to execute
        \item Set correct encoding before presenting data to the user
        \item Set correct encoding before using data from the user
      \end{itemize}
    \end{frame}
    \begin{frame}
      \frametitle{Bind parameters}
      \begin{block}{Rule of thumb}
        Never use unbound variables in database queries and such.

        Even if the variable can't be manipulated by the user, there is no reason
        to not bind the variable in a prepared statement.
      \end{block}
    \end{frame}
    \begin{frame}[fragile]
      \frametitle{Bind parameters}
      \begin{example}[Good]
      \begin{lstlisting}
PreparedStatement pstmt = con.prepareStatement(
  "SELECT * FROM EMPLOYEES WHERE ID = ?");
pstmt.setInt(1, id);
      \end{lstlisting}
      \end{example}
      \begin{example}[Bad]
      \begin{lstlisting}
con.execute(
  "SELECT * FROM EMPLOYEES WHERE ID = "+ id);
      \end{lstlisting}
      \end{example}
      \begin{example}[Worst]
      \begin{lstlisting}
PreparedStatement pstmt = con.prepareStatement(
  "SELECT * FROM EMPLOYEES WHERE ID = "+ id);
      \end{lstlisting}
      \end{example}
    \end{frame}
    \begin{frame}
      \frametitle{Error and Exceptionhandling}
      \begin{itemize}
        \item Expect the unexpected, i.e. all errors and exceptions should be handled
        \item Report as close to the source as possible
        \item Handle the error or exception where it make sense, i.e. rethrow to a point where you can recover gracefully
        \item Try to centralise the handling as much as possible
        \item Error messages should give enough information to the user about what went wrong, without leaking sensitive information
      \end{itemize}
    \end{frame}
    \begin{frame}
      \frametitle{Log wisely}
      \begin{itemize}
        \item Use correct log levels (Error, Warn, Info, Debug (, Trace))
        \item Diffrentiate between diffrent kinds of logs (e.g. Audit, Access, Error, Operation, Debug)
        \item The logs can act as an attack vector, untrusted input should never be logged without proper encoding
        \item Protect the logs if they contain sensitive data (as a rule of thumb, this should only happend during debug and development)
      \end{itemize}
    \end{frame}
    \begin{frame}
      \frametitle{Log wisely}
      \begin{block}{Use a proper logger}
        Never use \emph{System.out.println(), printf()} or the like for logging!

        Use a proper logging mechanism with support for diffrent log levels and
        diffrent log targets.
      \end{block}
      \begin{block}{The relation between error messages and error logs}
        An error message is intended for the end user for information that \emph{something went wrong}.

        The error log is intended for support personnel to see \emph{exactly what went wrong}.

        The error message should contain enough information to map it to an entry in the error log,
        the actual data to investigate the error should be located to the error log.
      \end{block}
    \end{frame}
    \begin{frame}
      \frametitle{Control access}
      \begin{itemize}
        \item Identify, Authenticate, Authorise
        \item Protect passwords
        \item Expire sessions
        \item All requests must go through access controls
        \item Deny by default
        \item Do not hardcode the access control checks, centralise it
        \item Since all clients should be seen as hostile, access controls must be server side
      \end{itemize}
    \end{frame}
    \begin{frame}
      \frametitle{Protect data}
      \begin{itemize}
        \item Encrypt all data in transit
        \item Encrypt sensitive data at rest
        \item Restrict access to data at rest with access controls
        \item Use functions to wipe transient memory and prevent swapping of sensitive information
      \end{itemize}
    \end{frame}
    \begin{frame}
      \frametitle{Don't reinvent the wheel}
      \begin{itemize}
        \item Use well known 3rd party libraries and frameworks that's actively maintained (especially regarding cryptography)
        \item Centralise and create internal libraries with common functionality
      \end{itemize}
    \end{frame}
  \subsection{Tests}
    \begin{frame}
      \frametitle{Tests}
      \begin{itemize}
        \item
      \end{itemize}
    \end{frame}

  \subsection{Static analysis}
    \begin{frame}
    \frametitle{Static analysis}
    \begin{itemize}
    \item
    \end{itemize}
    \end{frame}

  \subsection{Code review}
    \begin{frame}
    \frametitle{Code review}
    \begin{itemize}
    \item
    \end{itemize}
    \end{frame}

\begin{frame}
\frametitle{Blocks of Highlighted Text}
\begin{block}{Block 1}
Lorem ipsum dolor sit amet, consectetur adipiscing elit. Integer lectus nisl, ultricies in feugiat rutrum, porttitor sit amet augue. Aliquam ut tortor mauris. Sed volutpat ante purus, quis accumsan dolor.
\end{block}

\begin{block}{Block 2}
Pellentesque sed tellus purus. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos himenaeos. Vestibulum quis magna at risus dictum tempor eu vitae velit.
\end{block}

\begin{block}{Block 3}
Suspendisse tincidunt sagittis gravida. Curabitur condimentum, enim sed venenatis rutrum, ipsum neque consectetur orci, sed blandit justo nisi ac lacus.
\end{block}
\end{frame}

\begin{frame}[fragile]
\frametitle{Code}
\begin{example}[Code]
\begin{lstlisting}
@Mock
private Belly belly;
private CookieMonster cookieMonster = new CookieMonster(belly);

@Test
public void cookieMonsterHaveNoCookies() {
  assertThat(cookieMonster.haveCookies())
    .as("Should reply with no cookie but did not")
    .isEqualToIgnoringCase("Cookiemonster have no cookie");
}
\end{lstlisting}
\end{example}
\end{frame}

\begin{frame}[fragile] % Need to use the fragile option when verbatim is used in the slide
\frametitle{Citation}
An example of the \verb|\cite| command to cite within the presentation:\\~

This statement requires citation \cite{p1}.
\end{frame}

%------------------------------------------------

\begin{frame}
\frametitle{References}
\footnotesize{
\begin{thebibliography}{99} % Beamer does not support BibTeX so references must be inserted manually as below
\bibitem[Smith, 2012]{p1} John Smith (2012)
\newblock Title of the publication
\newblock \emph{Journal Name} 12(3), 45 -- 678.
\end{thebibliography}
}
\end{frame}

%------------------------------------------------

\begin{frame}
\Huge{\centerline{The End}}
\end{frame}

%----------------------------------------------------------------------------------------

\end{document}
